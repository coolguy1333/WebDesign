<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MHS IT Club</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>MHS IT Club</h1>
    <nav class="top-nav" aria-label="Main navigation">
      <a href="minecraft.html">Minecraft Server</a>
      <a class="active" href="index.html">Home</a>
      <a href="https://discord.gg/ex3BMp4W" target="_blank" rel="noopener noreferrer">Discord</a>
    </nav>
  </header>

  <main>

    <!-- Minecraft Section -->
    <section class="card" id="minecraft">
      <h2>Minecraft Server</h2>

      <p class="muted">
        Club server for building, experimenting, and hanging out.
        Works on <strong>Java</strong> and <strong>Bedrock</strong>.
      </p>

      <p>
        <strong>Server Address:</strong><br>
        <span class="mono">play.mhsit.club</span>
      </p>

      <div class="status-grid">
        <div class="status-item">
          <div class="status-title">Overall players</div>
          <div class="status-value" id="overall-players">Checking…</div>
        </div>

        <div class="status-item">
          <div class="status-title">Java</div>
          <div class="status-value" id="java-status">Checking…</div>
        </div>

        <div class="status-item">
          <div class="status-title">Bedrock</div>
          <div class="status-value" id="bedrock-status">Checking…</div>
        </div>
      </div>

      <p class="small muted">
        Bedrock port: <strong>19132</strong>
      </p>

      <p>
        <a class="button" href="minecraft.html">Server details</a>
        <a class="button button-outline" href="https://discord.gg/ex3BMp4W" target="_blank">Join Discord</a>
      </p>
    </section>

    <!-- Meetings Section -->
    <section class="card" id="meetings">
      <h2>Meetings</h2>

      <p class="muted">
        All meetings are online. This calendar updates automatically.
      </p>

      <div class="calendar-embed">
        <iframe
          title="MHS IT Club Calendar (Agenda)"
          src="https://calendar.google.com/calendar/embed?src=0a8f741060f1b0390913f97be2dee26c0476b08a47bbb615ef88bb0e29572b38%40group.calendar.google.com&ctz=America%2FChicago&mode=AGENDA&showTitle=0&showTabs=0&showPrint=0&showCalendars=0&showTz=0"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </section>

  </main>

  <footer>
    © 2026 MHS IT Club ·
    <a href="https://discord.gg/ex3BMp4W" target="_blank">Discord</a>
  </footer>

  <script>
    const REFRESH_MS = 15000;
    const TIMEOUT_MS = 8000;

    function setBadge(el, state, text) {
      if (!el) return;
      el.classList.remove("ok", "bad", "muted");

      if (state === true) {
        el.textContent = text || "Online";
        el.classList.add("ok");
      } else if (state === false) {
        el.textContent = text || "Offline";
        el.classList.add("bad");
      } else {
        el.textContent = text || "Unavailable";
        el.classList.add("muted");
      }
    }

    async function fetchJsonWithTimeout(url) {
      const controller = new AbortController();
      const t = setTimeout(() => controller.abort(), TIMEOUT_MS);

      try {
        const res = await fetch(url, { cache: "no-store", signal: controller.signal });
        if (!res.ok) throw new Error("HTTP " + res.status);
        return await res.json();
      } finally {
        clearTimeout(t);
      }
    }

    async function refresh() {
      try {
        const java = await fetchJsonWithTimeout(`/api/java?t=${Date.now()}`);
        const bedrock = await fetchJsonWithTimeout(`/api/bedrock?t=${Date.now()}`);

        setBadge(document.getElementById("java-status"), java.online);
        setBadge(document.getElementById("bedrock-status"), bedrock.online);

        if (java.online && java.players) {
          setBadge(
            document.getElementById("overall-players"),
            true,
            `${java.players.online} / ${java.players.max}`
          );
        } else {
          setBadge(document.getElementById("overall-players"), false);
        }

      } catch {
        setBadge(document.getElementById("java-status"), null);
        setBadge(document.getElementById("bedrock-status"), null);
        setBa
